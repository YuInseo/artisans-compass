/* BlockNote Theme Overrides to match App Theme */
:root {
    --bn-colors-editor-text: hsl(var(--foreground));
    --bn-colors-editor-background: transparent;

    --bn-colors-menu-text: hsl(var(--popover-foreground));
    --bn-colors-menu-background: hsl(var(--popover));

    --bn-colors-tooltip-text: hsl(var(--popover-foreground));
    --bn-colors-tooltip-background: hsl(var(--popover));

    --bn-colors-hovered-text: hsl(var(--accent-foreground));
    --bn-colors-hovered-background: hsl(var(--accent));

    --bn-colors-selected-text: hsl(var(--accent-foreground));
    --bn-colors-selected-background: hsl(var(--accent));

    --bn-colors-disabled-text: hsl(var(--muted-foreground));
    --bn-colors-disabled-background: hsl(var(--muted));

    --bn-colors-shadow: hsl(var(--border));
    --bn-colors-border: hsl(var(--border));

    --bn-colors-side-menu: hsl(var(--muted-foreground));

    --bn-border-radius: var(--radius);
    --bn-font-family: var(--font-sans, "Inter", sans-serif);
}

.dark {
    --bn-colors-editor-background: transparent;
}

.bn-editor {
    /* 기존의 max-content는 지우세요 */
    /* max-width: max-content; (삭제) */

    /* 부모(가운데 컬럼)의 너비를 가득 채우되 넘지 않음 */
    width: 100%;
    max-width: 100%;

    /* 긴 단어나 URL이 있을 때 강제로 줄바꿈 */
    overflow-wrap: break-word;
    white-space: pre-wrap;

    /* 테두리나 패딩 때문에 튀어나가는 것 방지 */
    box-sizing: border-box;

    /* 배경/색상은 기존 유지 */
    background-color: transparent !important;
    color: hsl(var(--foreground)) !important;
}

/* Placeholder Styling */
.bn-editor .bn-block-content.bn-is-empty::before,
.bn-editor p.is-empty::before,
.bn-editor .is-empty::before {
    color: hsl(var(--muted-foreground)) !important;
    opacity: 1 !important;
    -webkit-text-fill-color: hsl(var(--muted-foreground)) !important;
}

/* Ensure Input Text Color & Overflow Protection */
.bn-editor,
.bn-editor p,
.bn-editor div,
.bn-block-content {
    color: hsl(var(--foreground)) !important;
    -webkit-text-fill-color: hsl(var(--foreground));

    /* Text Wrapping Fixes */
    max-width: 100%;
    word-break: break-word;
    /* Prevent overflow */
    overflow-wrap: break-word;
    white-space: pre-wrap;
}

.bn-side-menu .bn-button {
    color: var(--bn-colors-side-menu);
    transform: none !important;
    transition: none !important;
    animation: none !important;
}

.bn-side-menu .bn-button:hover {
    transform: none !important;
    background-color: transparent !important;
    /* Optional: if background change is annoying too */
}

/* Hide indentation lines via border color */
.bn-block-group {
    border-color: hsl(var(--border));
}

/* Target via Class AND Data Attribute for robustness */
.hide-indent-guides .bn-block-group,
[data-hide-indent="true"] .bn-block-group,
[data-hide-indent="true"] [data-content-type="block-group"] {
    border-left-color: transparent !important;
    border-left-style: none !important;
    border-left-width: 0 !important;
    border-left: none !important;
    border-color: transparent !important;
    box-shadow: none !important;
}

/* Also target pseudo-elements just in case the theme uses them for lines */
/* Also target pseudo-elements just in case the theme uses them for lines */
[data-hide-indent="true"] .bn-block-group::before,
[data-hide-indent="true"] .bn-block-group::after,
[data-hide-indent="true"] [data-content-type="block-group"]::before,
[data-hide-indent="true"] [data-content-type="block-group"]::after {
    border-left: none !important;
    background: transparent !important;
    display: none !important;
    opacity: 0 !important;
}

/* NUCLEAR OPTION: High Specificity to Kill Indentation Lines */
html body [data-hide-indent="true"] .bn-block-group,
html body [data-hide-indent="true"] [data-content-type="block-group"],
html body [data-hide-indent="true"] .bn-block-group *,
html body .hide-indent-guides .bn-block-group,
html body .hide-indent-guides [data-content-type="block-group"] {
    border-left-color: transparent !important;
    border-left: 0 !important;
    border-left-color: transparent !important;
    border-color: transparent !important;
    box-shadow: none !important;
    /* User specifically mentioned 'inline' - handling logical properties */
    border-inline: none !important;
    border-inline-start: none !important;
    border-inline-start-width: 0 !important;
    border-inline-style: none !important;
}

/* NUCLEAR OPTION: Target EVERYTHING inside the group if hidden */
html body [data-hide-indent="true"] .bn-block-group *,
html body .hide-indent-guides .bn-block-group * {
    border-left-color: transparent !important;
    border-left: none !important;
    border-inline-start: none !important;
    border-inline-start-color: transparent !important;
    box-shadow: none !important;
}

/* User Identified Target: Pseudo-element on bn-block-group */
html body [data-hide-indent="true"] .bn-block-group::before,
html body .hide-indent-guides .bn-block-group::before,
html body [data-hide-indent="true"] .bn-block-group::after,
html body .hide-indent-guides .bn-block-group::after,
html body [data-hide-indent="true"] .bn-block-group>div::before,
html body .hide-indent-guides .bn-block-group>div::before {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
    border: none !important;
    background: transparent !important;
    content: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    position: static !important;
    /* Prevent it from taking up layout space */
}

/* Additional specific targeting for BlockNote's new structure if updated */
[data-hide-indent="true"] .bn-block-group,
[data-hide-indent="true"] .bn-block-group-content,
[data-hide-indent="true"] .bn-block-group .bn-block-group {
    border-left: none !important;
}

/* Context Menu Styling */
.bn-menu-dropdown {
    border: 1px solid hsl(var(--border));
    background-color: hsl(var(--popover));
    color: hsl(var(--popover-foreground));
}

/* Journey Log Theme (Read-Only context) */
.journey-log-theme .bn-editor {
    padding-left: 0 !important;
    padding-right: 0 !important;
}

/* Daily Focus Theme (Editable context) */
.daily-focus-theme .bn-editor {
    padding-left: 2.25rem !important;
    /* Increased to fit drag handle (was 0.5rem, too small) */
}

/* Fix Drag Ghosting: Ensure blocks represent a solid layer */
.bn-block-content,
.bn-block {
    /* Improve drag snapshot quality by ensuring no weird transparency artifacts */
    transform: translateZ(0);
}

/* Min height for empty blocks */
.bn-editor .bn-block-content {
    min-height: 1.5em;
}